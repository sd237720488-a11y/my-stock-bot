<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaSystem å®è§‚å…¨æ™¯æŒ‡æŒ¥å° V4.3 (ç½‘ç»œä¼˜åŒ–ç‰ˆ)</title>
    
    <!-- 1. æ ¸å¿ƒå›¾è¡¨åº“ (ä½¿ç”¨ Staticfile CDN åŠ é€Ÿ) -->
    <script src="https://cdn.staticfile.org/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    
    <!-- 2. æ ·å¼åº“ (Tailwind) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 3. å¤‡ç”¨æ ·å¼ (é˜²æ­¢ Tailwind åŠ è½½å¤±è´¥æ—¶çš„ä¿åº•) -->
    <style>
        /* åŸºç¡€é‡ç½®ï¼Œç¡®ä¿å°±ç®—æ²¡åŠ è½½ CSS ä¹Ÿèƒ½çœ‹ */
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; padding: 20px; }
        .card { border: 1px solid #334155; padding: 20px; margin-bottom: 20px; border-radius: 8px; background: #1e293b; }
        button { cursor: pointer; }
        /* å¦‚æœ Tailwind åŠ è½½æˆåŠŸï¼Œä¸‹é¢è¿™äº›ç±»ä¼šè¢«è¦†ç›–ï¼Œä¸å½±å“ */
        .input-dark { background-color: #0f172a; border: 1px solid #475569; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; width: 100%; font-size: 0.875rem; font-family: monospace; text-align: right; }
        .btn-primary { background-color: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; transition: all 0.2s; width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.875rem; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-primary:disabled { background-color: #334155; cursor: not-allowed; color: #94a3b8; }
        
        .status-badge { padding: 0.15rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700; display: inline-block; }
        .status-safe { background-color: #064e3b; color: #34d399; border: 1px solid #059669; }
        .status-warn { background-color: #451a03; color: #fbbf24; border: 1px solid #b45309; }
        .status-danger { background-color: #450a0a; color: #fca5a5; border: 1px solid #b91c1c; }
        .status-neutral { background-color: #1e293b; color: #94a3b8; border: 1px solid #475569; }

        .metric-label { font-size: 0.7rem; color: #94a3b8; font-weight: bold; margin-bottom: 0.25rem; }
        
        .divider { border-top: 1px solid #334155; margin: 1rem 0; }
        
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="p-4 md:p-8 max-w-7xl mx-auto min-h-screen flex flex-col">

    <!-- é¡¶éƒ¨ Header -->
    <header class="mb-6 border-b border-slate-700 pb-4 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h1 class="text-xl font-bold text-white flex items-center gap-3">
                <span class="text-2xl">ğŸ›ï¸</span> AlphaSystem å®è§‚å…¨æ™¯æŒ‡æŒ¥å°
                <span class="text-[10px] bg-slate-800 text-slate-300 px-2 py-1 rounded border border-slate-600 font-mono">V4.3 ç¨³å®šç‰ˆ</span>
            </h1>
            <p class="text-slate-400 text-xs mt-2 max-w-2xl leading-relaxed">
                <span class="text-emerald-400 font-bold">âœ… å·²åŒæ­¥æœ€æ–°å¸‚åœºæ•°æ® (2026-01-07 å¿«ç…§)</span><br>
                æ— éœ€ç­‰å¾… API åŠ è½½ï¼Œæ ¸å¿ƒå®è§‚æ•°æ®å·²å†…ç½®ã€‚ç‚¹å‡»å³ä¾§æŒ‰é’®å¯æ ¡å‡†æœ€æ–°å®æ—¶æ•°æ®ã€‚
            </p>
        </div>
        
        <div class="flex flex-col items-end gap-2 w-full md:w-auto">
            <div class="flex gap-2 w-full md:w-auto items-center bg-slate-800 p-2 rounded border border-slate-700">
                <span class="text-[10px] text-slate-400 font-bold mr-2">API å¯†é’¥</span>
                <input type="text" id="apiKey" value="O0VQP18WF8I5N66X" class="input-dark w-32 border-none bg-slate-900" placeholder="AlphaVantage Key">
                <button onclick="fetchOfficialData()" id="fetchBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-xs font-bold transition-colors flex items-center gap-2">
                    <span id="btnIcon">ğŸ“¡</span> æ ¡å‡†å®æ—¶æ•°æ®
                </button>
            </div>
            <div class="text-[10px] text-slate-500 font-mono" id="lastUpdate">çŠ¶æ€: å†…ç½®å¿«ç…§å·²åŠ è½½</div>
        </div>
    </header>

    <!-- æ ¸å¿ƒå†³ç­–åŒºï¼šé£æ§ä¿¡å·æ€»è§ˆ -->
    <div class="mb-8">
        <div class="card border-l-4 border-l-blue-500 bg-slate-800/50">
            <div class="flex flex-col md:flex-row gap-6 items-center">
                
                <!-- ç»¼åˆè¯„çº§ -->
                <div class="flex-1 text-center md:text-left">
                    <div class="metric-label">å½“å‰å®è§‚é£é™©ç­‰çº§</div>
                    <div class="text-4xl font-black text-white mb-2" id="globalRiskTitle">è®¡ç®—ä¸­...</div>
                    <div id="globalRiskDesc" class="text-sm text-slate-400">æ­£åœ¨åˆ†æäº”ç»´æ¨¡å‹...</div>
                </div>

                <!-- æ ¸å¿ƒå»ºè®® -->
                <div class="w-full md:w-auto bg-slate-900/80 p-4 rounded border border-slate-700 md:min-w-[300px]">
                    <div class="metric-label text-blue-400">èµ„äº§é…ç½®å»ºè®® (ä»“ä½)</div>
                    <div class="text-xl font-bold text-white mb-1" id="allocationTitle">--</div>
                    <div class="text-xs text-slate-400" id="allocationDesc">--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ•°æ®é¢æ¿åŒº -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- 1. æ ¸å¿ƒå®è§‚ (å®˜æ–¹æ•°æ®) -->
        <div class="card border-t-4 border-t-blue-600">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-sm text-white flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-blue-500"></span> å®˜æ–¹å®è§‚æ•°æ® (å†…ç½®)
                </h2>
                <span class="text-[10px] text-slate-500">æ¥æº: ç¾è”å‚¨ FRED</span>
            </div>

            <!-- è¨å§†è§„åˆ™ -->
            <div class="mb-6">
                <div class="flex justify-between items-end mb-1">
                    <span class="metric-label">è¨å§†è§„åˆ™ (å¤±ä¸šç‡)</span>
                    <span id="badge_sahm" class="status-badge status-neutral">--</span>
                </div>
                <div class="grid grid-cols-2 gap-4 bg-slate-900/50 p-3 rounded border border-slate-700/50">
                    <div>
                        <div class="text-[10px] text-slate-500">å½“å‰3ä¸ªæœˆå‡å€¼</div>
                        <!-- é¢„å¡« 4.10% -->
                        <input type="number" id="inp_sahm_cur" class="input-dark bg-transparent border-none text-lg p-0" readonly value="4.10">
                    </div>
                    <div class="text-right border-l border-slate-700 pl-4">
                        <div class="text-[10px] text-slate-500">è¿‡å»12æœˆæœ€ä½</div>
                        <!-- é¢„å¡« 3.70% -->
                        <input type="number" id="inp_sahm_low" class="input-dark bg-transparent border-none text-lg p-0" readonly value="3.70">
                    </div>
                </div>
                <div class="mt-2 text-[10px] text-slate-400 flex justify-between">
                    <span>åå¼¹å¹…åº¦: <strong id="val_sahm_diff" class="text-white">--</strong></span>
                    <span>ç†”æ–­é˜ˆå€¼: <strong>+0.50%</strong></span>
                </div>
            </div>

            <!-- æ”¶ç›Šç‡æ›²çº¿ -->
            <div class="mb-6">
                <div class="flex justify-between items-end mb-1">
                    <span class="metric-label">æ”¶ç›Šç‡æ›²çº¿ (10å¹´ - 2å¹´)</span>
                    <span id="badge_yield" class="status-badge status-neutral">--</span>
                </div>
                <div class="bg-slate-900/50 p-3 rounded border border-slate-700/50">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-slate-500">åˆ©å·® (Spread)</span>
                        <span class="text-xl font-mono font-bold text-white" id="val_yield_spread">--</span>
                    </div>
                    <div class="w-full h-1.5 bg-slate-700 rounded overflow-hidden relative">
                        <div class="absolute left-[30%] top-0 bottom-0 w-0.5 bg-white opacity-30"></div>
                        <div id="bar_yield" class="absolute top-0 bottom-0 bg-slate-500 transition-all duration-500" style="left: 30%; width: 0%;"></div>
                    </div>
                    <!-- éšè—çš„è¾“å…¥æ¡†ç”¨äºå­˜å‚¨å€¼ -->
                    <input type="hidden" id="inp_y10" value="4.45">
                    <input type="hidden" id="inp_y2" value="4.25">
                </div>
            </div>

            <!-- é€šèƒ€ -->
            <div>
                <div class="flex justify-between items-end mb-1">
                    <span class="metric-label">CPI é€šèƒ€ç‡ (åŒæ¯”)</span>
                    <span id="badge_cpi" class="status-badge status-neutral">--</span>
                </div>
                <div class="bg-slate-900/50 p-3 rounded border border-slate-700/50 flex justify-between items-center">
                    <span class="text-xs text-slate-500">æœ€æ–°å€¼</span>
                    <!-- é¢„å¡« 3.2% -->
                    <input type="number" id="inp_cpi" class="input-dark bg-transparent border-none text-xl p-0 w-24" readonly value="3.2">
                </div>
            </div>
        </div>

        <!-- 2. å¸‚åœºä¼°å€¼ (åŠè‡ªåŠ¨) -->
        <div class="card border-t-4 border-t-purple-600">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-sm text-white flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-purple-500"></span> å¸‚åœºä¼°å€¼ (å†…ç½®)
                </h2>
                <a href="https://www.currentmarketvaluation.com/" target="_blank" class="text-[10px] text-blue-400 hover:underline">æ ¸å¯¹æ•°æ® â†—</a>
            </div>

            <div class="bg-purple-900/20 border border-purple-700/30 p-3 rounded mb-4 text-[10px] text-purple-300">
                ğŸ“Š æ•°æ®å¿«ç…§ (2026/01/07):<br>å·´è²ç‰¹æŒ‡æ ‡å·²é£™å‡è‡³ 221%ï¼Œè¿œè¶… 200% è­¦æˆ’çº¿ã€‚
            </div>

            <!-- å·´è²ç‰¹æŒ‡æ ‡ -->
            <div class="mb-6">
                <div class="flex justify-between items-end mb-1">
                    <span class="metric-label">å·´è²ç‰¹æŒ‡æ ‡ (æ€»å¸‚å€¼/GDP)</span>
                    <span id="badge_buffett" class="status-badge status-neutral">--</span>
                </div>
                <div class="flex items-center gap-2">
                    <!-- é¢„å¡«äº† 221.7 -->
                    <input type="number" id="inp_buffett" class="input-dark bg-slate-800 border-slate-600 text-lg py-2 font-bold text-purple-400" value="221.7" oninput="calculateRisk()">
                    <span class="text-sm text-slate-500">%</span>
                </div>
                <div class="mt-2 w-full h-1 bg-slate-700 rounded relative">
                    <div class="absolute left-[25%] top-0 bottom-0 w-0.5 bg-slate-600 h-2 -mt-0.5"></div>
                    <div class="absolute left-[50%] top-0 bottom-0 w-0.5 bg-slate-600 h-2 -mt-0.5"></div>
                </div>
                <div class="flex justify-between text-[9px] text-slate-500 mt-1">
                    <span>ä½ä¼°</span>
                    <span>100% (åˆç†)</span>
                    <span>200% (æ³¡æ²«)</span>
                </div>
            </div>

            <!-- å¸­å‹’ PE -->
            <div>
                <div class="flex justify-between items-end mb-1">
                    <span class="metric-label">å¸­å‹’å¸‚ç›ˆç‡ (CAPE)</span>
                    <a href="https://www.multpl.com/shiller-pe" target="_blank" class="text-[10px] text-blue-400 hover:underline">æ ¸å¯¹</a>
                </div>
                <div class="flex items-center gap-2">
                    <!-- é¢„å¡«äº† 40.83 -->
                    <input type="number" id="inp_shiller" class="input-dark bg-slate-800 border-slate-600 text-lg py-2 font-bold text-purple-400" value="40.83" oninput="calculateRisk()">
                    <span class="text-sm text-slate-500">x</span>
                </div>
                <div class="mt-2 text-[10px] text-slate-500">
                    å†å²å‡å€¼: ~17x. å±é™©çº¿ > 35x.
                </div>
            </div>
        </div>

        <!-- 3. å¸‚åœºæƒ…ç»ª (åŠè‡ªåŠ¨) -->
        <div class="card border-t-4 border-t-emerald-600">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-sm text-white flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span> å¸‚åœºæƒ…ç»ª (å†…ç½®)
                </h2>
                <a href="https://edition.cnn.com/markets/fear-and-greed" target="_blank" class="text-[10px] text-blue-400 hover:underline">CNN å®˜ç½‘ â†—</a>
            </div>

            <!-- ææ…Œè´ªå©ª -->
            <div class="mb-6 flex-1 flex flex-col justify-center">
                <div class="text-center mb-4">
                    <div class="metric-label">ææ…Œä¸è´ªå©ªæŒ‡æ•°</div>
                    <!-- é¢„å¡«äº† 52 -->
                    <input type="number" id="inp_fear" value="52" class="input-dark bg-transparent border-none text-5xl font-black text-center p-0" oninput="calculateRisk()">
                    <div id="text_fear" class="text-sm font-bold text-slate-500 mt-2">--</div>
                </div>
                
                <input type="range" id="rng_fear" min="0" max="100" value="52" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500" oninput="syncFearInput(this.value)">
                
                <div class="flex justify-between text-[10px] text-slate-500 mt-2">
                    <span class="text-emerald-400">0 ææ(ä¹°)</span>
                    <span class="text-red-400">100 æè´ª(å–)</span>
                </div>
            </div>

            <div class="border-t border-slate-700 pt-4">
                <div class="flex justify-between items-center">
                    <span class="metric-label">VIX æ³¢åŠ¨ç‡æŒ‡æ•°</span>
                    <input type="number" id="inp_vix" class="input-dark w-20 bg-slate-800 border-slate-600" value="14.9" oninput="calculateRisk()">
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- å·¥å…·å‡½æ•° ---
        const getEl = (id) => document.getElementById(id);
        
        function syncFearInput(val) {
            getEl('inp_fear').value = val;
            calculateRisk();
        }

        // --- 1. ä¸¥æ ¼çš„æ•°æ®è·å– (åªè¿æ¥å®˜æ–¹æ•°æ®æº) ---
        async function fetchOfficialData() {
            const apiKey = getEl('apiKey').value.trim();
            const btn = getEl('fetchBtn');
            const icon = getEl('btnIcon');
            const statusDiv = getEl('lastUpdate');

            if(!apiKey) { alert("è¯·å¡«å†™ API å¯†é’¥"); return; }

            btn.disabled = true;
            btn.classList.add('opacity-75');
            icon.innerText = "â³";
            statusDiv.innerText = "æ­£åœ¨è¿æ¥ AlphaVantage...";

            try {
                // ä¸²è¡Œè¯·æ±‚ä»¥é˜² 429 (å…è´¹ç‰ˆé™åˆ¶)
                const resUnemp = await fetch(`https://www.alphavantage.co/query?function=UNEMPLOYMENT&apikey=${apiKey}`).then(r=>r.json());
                if(resUnemp.data) processSahm(resUnemp.data);
                await new Promise(r => setTimeout(r, 1500)); 

                const res10y = await fetch(`https://www.alphavantage.co/query?function=TREASURY_YIELD&interval=monthly&maturity=10year&apikey=${apiKey}`).then(r=>r.json());
                await new Promise(r => setTimeout(r, 1500));

                const res2y = await fetch(`https://www.alphavantage.co/query?function=TREASURY_YIELD&interval=monthly&maturity=2year&apikey=${apiKey}`).then(r=>r.json());
                if(res10y.data && res2y.data) processYield(res10y.data, res2y.data);
                await new Promise(r => setTimeout(r, 1500));

                const resCpi = await fetch(`https://www.alphavantage.co/query?function=CPI&interval=monthly&apikey=${apiKey}`).then(r=>r.json());
                if(resCpi.data) processCpi(resCpi.data);

                const now = new Date();
                statusDiv.innerText = `ä¸Šæ¬¡åŒæ­¥: ${now.toLocaleTimeString()}`;
                statusDiv.className = "text-[10px] text-emerald-400 font-mono";
                
                calculateRisk(); 

            } catch(e) {
                console.error(e);
                statusDiv.innerText = "åŒæ­¥ä¸­æ–­ (APIé™åˆ¶)";
                statusDiv.className = "text-[10px] text-red-400 font-mono";
                alert("ç½‘ç»œæˆ–APIé¢åº¦å—é™ï¼Œéƒ¨åˆ†è‡ªåŠ¨æ•°æ®å¯èƒ½æœªæ›´æ–°ã€‚æ‰‹åŠ¨æ•°æ®ä¸å—å½±å“ã€‚");
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-75');
                icon.innerText = "ğŸ“¡";
            }
        }

        // --- æ•°æ®å¤„ç†é€»è¾‘ ---

        function processSahm(data) {
            if(data.length < 24) return;
            const curMA = (parseFloat(data[0].value) + parseFloat(data[1].value) + parseFloat(data[2].value)) / 3;
            let minMA = 100;
            for(let i=0; i<12; i++) {
                const ma = (parseFloat(data[i].value) + parseFloat(data[i+1].value) + parseFloat(data[i+2].value)) / 3;
                if(ma < minMA) minMA = ma;
            }
            getEl('inp_sahm_cur').value = curMA.toFixed(2);
            getEl('inp_sahm_low').value = minMA.toFixed(2);
        }

        function processYield(d10, d2) {
            const y10 = parseFloat(d10[0].value);
            const y2 = parseFloat(d2[0].value);
            getEl('val_yield_spread').dataset.y10 = y10;
            getEl('val_yield_spread').dataset.y2 = y2;
            getEl('val_yield_spread').innerText = (y10 - y2).toFixed(2) + "%";
        }

        function processCpi(data) {
            if(data.length < 13) return;
            const cur = parseFloat(data[0].value);
            const prevYear = parseFloat(data[12].value);
            const yoy = ((cur - prevYear) / prevYear) * 100;
            getEl('inp_cpi').value = yoy.toFixed(2);
        }

        // --- é£æ§æ¨¡å‹ (Risk Engine) ---

        function calculateRisk() {
            // 1. è·å–æ‰€æœ‰æ•°å€¼ (æ¥è‡ªé¢„å¡«æˆ– API)
            const sahmCur = parseFloat(getEl('inp_sahm_cur').value);
            const sahmLow = parseFloat(getEl('inp_sahm_low').value);
            const sahmDiff = (!isNaN(sahmCur) && !isNaN(sahmLow)) ? (sahmCur - sahmLow) : null;

            // åˆ©å·®è®¡ç®—
            const y10 = parseFloat(getEl('inp_y10').value);
            const y2 = parseFloat(getEl('inp_y2').value);
            const ySpread = (!isNaN(y10) && !isNaN(y2)) ? (y10 - y2) : null;

            const cpi = parseFloat(getEl('inp_cpi').value);
            
            const buffett = parseFloat(getEl('inp_buffett').value); 
            const fear = parseFloat(getEl('inp_fear').value); 

            // 1. Sahm UI
            if (sahmDiff !== null) {
                const elDiff = getEl('val_sahm_diff');
                elDiff.innerText = (sahmDiff > 0 ? "+" : "") + sahmDiff.toFixed(2) + "%";
                elDiff.className = sahmDiff >= 0.5 ? "text-red-500 font-bold animate-pulse" : (sahmDiff >= 0.4 ? "text-yellow-400 font-bold" : "text-emerald-400 font-bold");
                
                const badge = getEl('badge_sahm');
                if(sahmDiff >= 0.5) { badge.className="status-badge status-danger"; badge.innerText="è¡°é€€ç¡®è®¤"; }
                else if(sahmDiff >= 0.4) { badge.className="status-badge status-warn"; badge.innerText="é«˜å±é¢„è­¦"; }
                else { badge.className="status-badge status-safe"; badge.innerText="å®‰å…¨"; }
            }

            // 2. Yield UI
            if (ySpread !== null) {
                const bar = getEl('bar_yield');
                const badge = getEl('badge_yield');
                getEl('val_yield_spread').innerText = (ySpread > 0 ? "+" : "") + ySpread.toFixed(2) + "%";

                let pct = ((ySpread + 1.0) / 3.0) * 100;
                pct = Math.max(0, Math.min(100, pct));
                
                bar.style.left = ySpread >= 0 ? "30%" : `${pct}%`;
                bar.style.width = ySpread >= 0 ? `${pct - 30}%` : `${30 - pct}%`;
                bar.style.backgroundColor = ySpread < 0 ? "#ef4444" : (ySpread < 0.3 ? "#eab308" : "#10b981");

                if(ySpread < 0) { badge.className="status-badge status-danger"; badge.innerText="å€’æŒ‚"; }
                else if(ySpread < 0.3) { badge.className="status-badge status-warn"; badge.innerText="æ‰å¹³/å›æ­£"; }
                else { badge.className="status-badge status-safe"; badge.innerText="æ­£å¸¸"; }
            }

            // 3. Fear UI
            if (!isNaN(fear)) {
                getEl('rng_fear').value = fear;
                const txt = getEl('text_fear');
                if(fear < 25) { txt.innerText = "æåº¦ææ…Œ (ä¹°å…¥)"; txt.className="text-sm font-bold text-emerald-400"; }
                else if(fear > 75) { txt.innerText = "æåº¦è´ªå©ª (å–å‡º)"; txt.className="text-sm font-bold text-red-400"; }
                else { txt.innerText = "ä¸­æ€§"; txt.className="text-sm font-bold text-slate-400"; }
            }
            
            // 4. Buffett UI
            if (!isNaN(buffett)) {
                const badge = getEl('badge_buffett');
                if (buffett > 200) { badge.className="status-badge status-danger"; badge.innerText="ä¸¥é‡æ³¡æ²«"; }
                else if (buffett > 150) { badge.className="status-badge status-warn"; badge.innerText="æ˜¾è‘—é«˜ä¼°"; }
                else { badge.className="status-badge status-safe"; badge.innerText="åˆç†"; }
            }
            
            // 5. CPI UI
            if (!isNaN(cpi)) {
                const badge = getEl('badge_cpi');
                if (cpi > 4.0) { badge.className="status-badge status-danger"; badge.innerText="æ¶æ€§é€šèƒ€"; }
                else if (cpi > 3.0) { badge.className="status-badge status-warn"; badge.innerText="ç²˜æ€§é€šèƒ€"; }
                else { badge.className="status-badge status-safe"; badge.innerText="æ¸©å’Œ"; }
            }

            // --- è¯„åˆ†é€»è¾‘ ---
            let riskLevel = "SAFE"; 
            let vetoReason = "";

            // ç†”æ–­ 1: è¨å§†è§„åˆ™
            if (sahmDiff !== null && sahmDiff >= 0.50) {
                riskLevel = "CRITICAL";
                vetoReason = "è¨å§†è§„åˆ™è§¦å‘ (+0.5%)";
            }
            
            // ç†”æ–­ 2: åˆ©å·®æ·±åº¦å€’æŒ‚æˆ–å›æ­£
            if (riskLevel !== "CRITICAL" && ySpread !== null) {
                if (ySpread < -0.2) { riskLevel = "DANGER"; vetoReason = "æ·±åº¦å€’æŒ‚"; }
                else if (ySpread >= 0 && ySpread < 0.2) { riskLevel = "DANGER"; vetoReason = "å€’æŒ‚å›æ­£ (è¡°é€€å‰å…†)"; }
            }

            // ç†”æ–­ 3: é€šèƒ€
            if (riskLevel !== "CRITICAL" && !isNaN(cpi) && cpi > 5.0) {
                riskLevel = "DANGER"; vetoReason = "é«˜é€šèƒ€ (>5%)";
            }

            // ä¼°å€¼é™æƒ
            if (riskLevel === "SAFE" || riskLevel === "CAUTION") {
                if (buffett > 180) riskLevel = "CAUTION"; 
                if (fear > 90) riskLevel = "CAUTION";    
            }

            const elTitle = getEl('globalRiskTitle');
            const elDesc = getEl('globalRiskDesc');
            const elAllocT = getEl('allocationTitle');
            const elAllocD = getEl('allocationDesc');
            const card = getEl('globalRiskTitle').parentElement.parentElement.parentElement; 

            if (riskLevel === "CRITICAL") {
                elTitle.innerText = "ğŸ”´ ä¸¥é‡ç†”æ–­";
                elTitle.className = "text-4xl font-black text-red-500 animate-pulse";
                elDesc.innerText = `ç†”æ–­è§¦å‘: ${vetoReason}`;
                elAllocT.innerText = "0% - 10% (ç©ºä»“)";
                elAllocD.innerText = "å®è§‚å´©åï¼Œç»æµè¡°é€€ç¡®è®¤ã€‚åˆ‡å‹¿æ¥é£åˆ€ã€‚";
                card.style.borderLeftColor = "#ef4444"; 
            } 
            else if (riskLevel === "DANGER") {
                elTitle.innerText = "ğŸŸ  å±é™©åŒºåŸŸ";
                elTitle.className = "text-4xl font-black text-orange-500";
                elDesc.innerText = `è­¦å‘Š: ${vetoReason || "å¤šé‡é£é™©å åŠ "}`;
                elAllocT.innerText = "20% - 30% (é˜²å®ˆ)";
                elAllocD.innerText = "å¤§å¹…å‡ä»“ï¼Œä¿ç•™æ ¸å¿ƒåº•ä»“ï¼Œåœæ­¢ä¹°å…¥ã€‚";
                card.style.borderLeftColor = "#f97316"; 
            }
            else if (riskLevel === "CAUTION") {
                elTitle.innerText = "ğŸŸ¡ éœ€è­¦æƒ•";
                elTitle.className = "text-4xl font-black text-yellow-400";
                elDesc.innerText = "é£é™©ç´¯ç§¯ (ä¼°å€¼è¿‡é«˜)";
                elAllocT.innerText = "40% - 50% (ä¸­æ€§)";
                elAllocD.innerText = "æš‚åœæ¿€è¿›åŠ ä»“ï¼Œç»´æŒå®šæŠ•ã€‚";
                card.style.borderLeftColor = "#eab308"; 
            }
            else {
                elTitle.innerText = "ğŸŸ¢ å®è§‚å®‰å…¨";
                elTitle.className = "text-4xl font-black text-emerald-400";
                elDesc.innerText = "åŸºæœ¬é¢å¥åº·";
                if (!isNaN(fear) && fear < 25) {
                    elAllocT.innerText = "80% - 100% (è¿›æ”»)";
                    elAllocD.innerText = "å®è§‚å®‰å…¨ + å¸‚åœºææ…Œ = é»„é‡‘å‘ã€‚";
                } else {
                    elAllocT.innerText = "60% - 70% (æˆé•¿)";
                    elAllocD.innerText = "ç¯å¢ƒæ¸©å’Œï¼ŒæŒ‰ä¸ªè‚¡ä¿¡å·æ“ä½œã€‚";
                }
                card.style.borderLeftColor = "#10b981"; 
            }
        }
        
        // åˆå§‹è®¡ç®—ï¼Œè®©é¢„å¡«æ•°æ®ç”Ÿæ•ˆ
        setTimeout(calculateRisk, 500);
    </script>
</body>
</html>
